(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{427:function(t,e,s){t.exports=s.p+"assets/img/virtual-memory.c299fd9b.jpg"},527:function(t,e,s){"use strict";s.r(e);var a=s(47),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("img",{attrs:{src:s(427),alt:"img"}})]),t._v(" "),a("p",[t._v("进程内存模型：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("- 操作系统会为进程分配一块为内存区域\n")])])]),a("ul",[a("li",[t._v("内存模型从高位到低位（其实也可以反过来思考，都是从低地址开始占用）\n"),a("ul",[a("li",[t._v("栈区")]),t._v(" "),a("li",[t._v("堆区")]),t._v(" "),a("li",[t._v("数据段")]),t._v(" "),a("li",[t._v("代码段")])])])]),t._v(" "),a("h3",{attrs:{id:"栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#栈"}},[t._v("#")]),t._v(" 栈")]),t._v(" "),a("p",[t._v("栈内存区是由操作系统为线程分配管理的，并且每条线程都有自己的内存栈，并且有硬件指令指支持（CPU的 POP 指令和 PUSH 指令、ESP寄存器、EBP寄存器），形成 LIFO（后进先出）的数据管理结构。")]),t._v(" "),a("p",[t._v("栈在内存的分配与归还速度极快，因为也就是指针方向移动而已。")]),t._v(" "),a("p",[t._v("大多数语言利用该内存栈，来保存函数内部的局部变量，并且形成函数调用栈。")]),t._v(" "),a("p",[t._v("栈内存可以通过创建线程时设置")]),t._v(" "),a("h3",{attrs:{id:"堆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆"}},[t._v("#")]),t._v(" 堆")]),t._v(" "),a("p",[t._v("堆内存是为动态分配预留的内存，由语言运行时去主动申请（molloc）或者销毁（free），堆内存是同属同一进程内的所有线程共享的。")]),t._v(" "),a("h3",{attrs:{id:"栈的调用过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#栈的调用过程"}},[t._v("#")]),t._v(" 栈的调用过程")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/xiangtingshen/p/11221277.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("对于ESP、EBP寄存器的理解"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/Od9X-qnQ3WWyZiLIS4uPFg",target:"_blank",rel:"noopener noreferrer"}},[t._v("图解函数调用过程"),a("OutboundLink")],1)])])]),t._v(" "),a("p",[a("strong",[t._v("esp是栈顶指针")]),t._v("，是cpu机制决定的，push、pop指令会自动调整esp的值；")]),t._v(" "),a("p",[a("strong",[t._v("ebp只是存取某时刻的esp，用来标识栈低")]),t._v("。进入一个函数内后开始，cpu会将esp的值赋给ebp，ebp 记录该栈底。")]),t._v(" "),a("p",[t._v("函数开始")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" push ebp // 记录上一个栈底\n mov ebp,esp // 设置 ebp 为当前栈底\n")])])]),a("p",[t._v("函数调用")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("call Fun // 将返回地址入栈\n")])])]),a("p",[t._v("函数结束")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mov esp, ebp // 将栈顶指针移动栈底\npop ebp // ebp 恢复上一栈底\nret // pop 返回地址，程序返回到主程序中，并执行下一条指令，并且移动 esp\n")])])]),a("p",[t._v("消除形参")]),t._v(" "),a("p",[a("strong",[t._v("释放参数涉及两种子函数调用标准，一种是STDCALL标准，一种是C标准。两种方式的核心思想就是修改esp。")])]),t._v(" "),a("hr"),t._v(" "),a("Vssue",{attrs:{title:t.$title}})],1)}),[],!1,null,null,null);e.default=r.exports}}]);