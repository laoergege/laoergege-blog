<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发一个七牛图床的 GithubAction | Laoergege Blog</title>
    <meta name="description" content="Just For Fun">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.9970a1b7.css" as="style"><link rel="preload" href="/assets/js/app.bf7dde31.js" as="script"><link rel="preload" href="/assets/js/2.66e7cddf.js" as="script"><link rel="preload" href="/assets/js/4.266dd422.js" as="script"><link rel="prefetch" href="/assets/js/10.d0162277.js"><link rel="prefetch" href="/assets/js/11.ff7cd92d.js"><link rel="prefetch" href="/assets/js/12.92931845.js"><link rel="prefetch" href="/assets/js/13.fd3db759.js"><link rel="prefetch" href="/assets/js/14.ae9b26ae.js"><link rel="prefetch" href="/assets/js/15.0702ed3e.js"><link rel="prefetch" href="/assets/js/16.7d86be63.js"><link rel="prefetch" href="/assets/js/17.5115c369.js"><link rel="prefetch" href="/assets/js/18.112cb4b6.js"><link rel="prefetch" href="/assets/js/19.4081b207.js"><link rel="prefetch" href="/assets/js/20.9348dfe7.js"><link rel="prefetch" href="/assets/js/21.aa3a83bc.js"><link rel="prefetch" href="/assets/js/22.3ce6a5db.js"><link rel="prefetch" href="/assets/js/23.bafad5ba.js"><link rel="prefetch" href="/assets/js/24.d384b5c0.js"><link rel="prefetch" href="/assets/js/25.a7b9eb34.js"><link rel="prefetch" href="/assets/js/26.3a65bb16.js"><link rel="prefetch" href="/assets/js/27.0df66992.js"><link rel="prefetch" href="/assets/js/28.b589b028.js"><link rel="prefetch" href="/assets/js/29.1969fcfc.js"><link rel="prefetch" href="/assets/js/3.6cb52dc0.js"><link rel="prefetch" href="/assets/js/30.0a052597.js"><link rel="prefetch" href="/assets/js/31.6e6b21b5.js"><link rel="prefetch" href="/assets/js/32.63d4a6f8.js"><link rel="prefetch" href="/assets/js/33.8713ee7e.js"><link rel="prefetch" href="/assets/js/34.3ee7c3ed.js"><link rel="prefetch" href="/assets/js/35.bf52df44.js"><link rel="prefetch" href="/assets/js/36.eb269e3a.js"><link rel="prefetch" href="/assets/js/37.e872c36e.js"><link rel="prefetch" href="/assets/js/38.54732fa4.js"><link rel="prefetch" href="/assets/js/39.149207b8.js"><link rel="prefetch" href="/assets/js/40.ddc1dfa8.js"><link rel="prefetch" href="/assets/js/5.c414ada2.js"><link rel="prefetch" href="/assets/js/6.fc12d6fe.js"><link rel="prefetch" href="/assets/js/7.89ef861f.js"><link rel="prefetch" href="/assets/js/8.95d8b272.js"><link rel="prefetch" href="/assets/js/9.7aa46540.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9970a1b7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Laoergege Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaScript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/NodeJS/" class="nav-link">
  NodeJS
</a></div><div class="nav-item"><a href="/Git/" class="nav-link router-link-active">
  Git
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JavaScript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/NodeJS/" class="nav-link">
  NodeJS
</a></div><div class="nav-item"><a href="/Git/" class="nav-link router-link-active">
  Git
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Git 博客开发系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Git/使用 GithubPage、GithubAction、VuePress 搭建个人博客.html" class="sidebar-link">使用 GithubPage、GithubAction、VuePress 搭建个人博客</a></li><li><a href="/Git/开发一个七牛图床的 GithubAction.html" class="active sidebar-link">开发一个七牛图床的 GithubAction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Git/开发一个七牛图床的 GithubAction.html#开通七牛云服务" class="sidebar-link">开通七牛云服务</a></li><li class="sidebar-sub-header"><a href="/Git/开发一个七牛图床的 GithubAction.html#vuepress-webpack-构建配置修改" class="sidebar-link">vuepress webpack 构建配置修改</a></li><li class="sidebar-sub-header"><a href="/Git/开发一个七牛图床的 GithubAction.html#sync-to-qiniu-action" class="sidebar-link">sync-to-qiniu-action</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>一般情况，笔者喜欢将图片和文件置于同个项目中，写作的时候方便直接相对引用显示，构建时替换成 Github Raw 线上地址。但由于国内访问 Github 上仓库的图片速度是比较慢的，使用 Github 作为图床是不太理想。<a href="https://www.qiniu.com/" target="_blank" rel="noopener noreferrer">七牛云<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>对注册用户提供了免费 10G 的对象储存，刚好可以用来作为图床。</p> <p>梳理下本次需求：</p> <ol><li>源图片文件存储在同项目中，方便写作时或者 vuepress dev 模式下直接预览</li> <li>源图片文件能够自动上传七牛云</li> <li>构建成功时 url 自动替换成七牛云对象储存地址</li></ol> <p>借此机会，笔者正好学习开发一个 Github Action，能够自动将项目中指定的文件夹（即储存图片的 images 文件夹）的内容同步到七牛对象储存上。</p> <h2 id="开通七牛云服务"><a href="#开通七牛云服务" class="header-anchor">#</a> 开通七牛云服务</h2> <h2 id="vuepress-webpack-构建配置修改"><a href="#vuepress-webpack-构建配置修改" class="header-anchor">#</a> vuepress webpack 构建配置修改</h2> <p>根据上述的需求，我们在项目中创建一个 <code>src/images</code> 目录用于存放图片，静态写作时，我们只需要相对引用图片，笔者用 vscode 及相关 markdown 插件进行编写及同步预览。有时我们也需要线下 vuepress dev 开发模式，查看效果如何，通过查看 vuepress 源码，了解 vuepress 构建时使用 <a href="https://github.com/webpack-contrib/url-loader" target="_blank" rel="noopener noreferrer">url-loader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对图片资源进行处理，10KB 大小下的图片转成 base64 嵌入。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// node_modules/@vuepress/core/lib/node/webpack/createBaseConfig.js</span>

config<span class="token punctuation">.</span>module
    <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.(png|jpe?g|gif)(\?.*)?$/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          limit<span class="token operator">:</span> inlineLimit <span class="token comment">// 10KB,</span>
          name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">assets/img/[name].[hash:8].[ext]</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这在 dev 模式下依旧符合我们期望，但在 build 模式下构建出来的资源对图片的引用，我们需要构建时替换成七牛云的外链域名地址，我们需要对 vupress webpack config 进行修改。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>

<span class="token operator">...</span>
<span class="token function-variable function"> chainWebpack</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> isServer<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.(png|jpe?g|gif)(\?.*)?$/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          limit<span class="token operator">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">// 100KB</span>
          name<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'[name].[hash:8].[ext]'</span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">assets/img/[name].[hash:8].[ext]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          publicPath<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token constant">IMG_URL</span> <span class="token operator">:</span> <span class="token string">'/'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>做完上面，接下来的一个主要需求就是：将 <code>src/images</code> 目录下的图片同步到七牛云对象储存上。笔者将这个功能开发成一个 <code>sync-to-qiniu-action</code> 的 Github Action，方便以后其他项目使用。</p> <h2 id="sync-to-qiniu-action"><a href="#sync-to-qiniu-action" class="header-anchor">#</a> sync-to-qiniu-action</h2> <h3 id="关于-github-action"><a href="#关于-github-action" class="header-anchor">#</a> 关于 Github Action</h3> <p>Github Action 就是一个独立的脚本，您可以通过编写自定义代码来创建操作某些操作，比如说可以读写仓库、发送短信、或者调用 github 或第三方的 API。然后你可以使用在你的 workflow 中使用本地或者公开仓库，github 商城分享给其他人使用（Docker 实现的 Action 则通过 Docker Hub 等镜像仓库平台分享）的 action。其实 Github Action 类似于 npm 包，只不过用于 CI/CD 中。</p> <p>Github Action 分成两类实现：</p> <ul><li>Docker 容器实现，Docker 实现更为强大自由，可以自定义操作系统和工具，但由于构建延迟，Docker 容器操作比JavaScript操作慢。</li> <li>JavaScript 实现，直接运行在机器上，执行速度更快。</li></ul> <h4 id="如何使用-github-action"><a href="#如何使用-github-action" class="header-anchor">#</a> 如何使用 Github Action</h4> <p><strong>使用公开仓库的 Action</strong>
如果 action 是独立公开仓库，你可以使用 <code>{owner}/{repo}@{ref}</code> 或者 <code>{owner}/{repo}/{path}@{ref}</code> 去引用</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_first_job</span><span class="token punctuation">:</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> My first step
      <span class="token comment"># Uses the master branch of a public repository</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/heroku@master
      <span class="token comment"># use a specific version tag of a public repository</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> My second step
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/aws@v2.0.1
</code></pre></div><p><strong>使用同仓库下的 Action</strong>
如果 Action 跟 workflow 是位于统一仓库，你能使用<strong>相对仓库根目录</strong>去引入<code>./path/to/dir</code></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_first_job</span><span class="token punctuation">:</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Check out repository
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use local my<span class="token punctuation">-</span>action
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> ./.github/actions/my<span class="token punctuation">-</span>action
</code></pre></div><p>从某个角度来说，该 action 也是在一个公开仓库的某个路径下，故可以使用 <code>{owner}/{repo}@{ref}</code> 或者 <code>{owner}/{repo}/{path}@{ref}</code> 去引入。</p> <p>推荐将 Github Action 作为一个独立仓库进行维护，而不是放在在某个应用的仓库中，这样方便<strong>分享、跟踪、迭代</strong>。如果不是想分享，而是想自我单独快速使用，推荐放在 <code>.github/actions</code> 文件下，比如 <code>.github/actions/action-a</code> 和 <code>.github/actions/action-b</code>，并使用相对路径引用。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_first_job</span><span class="token punctuation">:</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> My first step
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> ./.github/actions/my<span class="token punctuation">-</span>action
</code></pre></div><p><strong>使用 Docker Hub上发布的 Docker 容器镜像 Action</strong> <code>docker://{image}:{tag}</code></p> <div class="language- extra-class"><pre class="language-text"><code>jobs:
  my_first_job:
    steps:
      - name: My first step
        uses: docker://alpine:3.8
</code></pre></div><h3 id="github-action-开发"><a href="#github-action-开发" class="header-anchor">#</a> Github Action 开发</h3> <p>本次开发中我们选择以 JavaScript 实现的 Github Action 方式。</p> <p><a href="https://github.com/actions/toolkit" target="_blank" rel="noopener noreferrer">actions/toolkit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> The GitHub ToolKit for developing GitHub Actions. 不仅提供了开发工具包，并且提供了项目模板以及问题技巧</p> <p><img src="http://images.laoergege.cn/actions-toolkit_20200406200055.png" alt=""></p> <p>创建项目我们可以使用官方提供的开发模板 <a href="https://github.com/actions/javascript-action" target="_blank" rel="noopener noreferrer">actions/javascript-action<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>进入模板仓库，点击 <strong>Use this template</strong> 创建模板</p> <p><img src="http://images.laoergege.cn/use-template_20200406200309.png" alt=""></p> <p>创建好模板仓库，我们需要调整修改某些文件，其中最主要的就是 action.yml。</p> <h4 id="action-yml"><a href="#action-yml" class="header-anchor">#</a> action.yml</h4> <p>action.yml 相当 npm 包 package.json ，用于描述 action 的相关信息。</p> <p>input 大写将被转成小写，input的value将被作为环境变量，格式 <code>INPUT_&lt;VARIABLE_NAME&gt;</code>，比如 numOctocats 将被转成 INPUT_NUMOCTOCATS。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'sync-to-qiniu-action'</span>
<span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'Synchronize the contents of your folder to qiniu'</span>
<span class="token key atrule">inputs</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessKey</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'qiniu accessKey'</span>
    <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> 
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'qiniu secretKey'</span>
    <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">bucket</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'qiniu bucket'</span>
    <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">zone</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'bucket zone'</span>
    <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">folderPath</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'The folder which will sync to the qiniu'</span>
    <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">fsizeLimit</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'Maximum upload file size limit(byte)'</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span> 5 * 1024 * 1024 <span class="token comment">#默认 5M</span>
  <span class="token key atrule">mimeLimit</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'File MimeType'</span>
<span class="token key atrule">runs</span><span class="token punctuation">:</span>
  <span class="token key atrule">using</span><span class="token punctuation">:</span> <span class="token string">'node12'</span>
  <span class="token key atrule">main</span><span class="token punctuation">:</span> <span class="token string">'dist/index.js'</span>
  <span class="token key atrule">post</span><span class="token punctuation">:</span> <span class="token string">'dist/index.js'</span>
<span class="token key atrule">branding</span><span class="token punctuation">:</span>
  <span class="token key atrule">icon</span><span class="token punctuation">:</span> <span class="token string">'upload-cloud'</span>
  <span class="token key atrule">color</span><span class="token punctuation">:</span> <span class="token string">'blue'</span>
</code></pre></div><p>更多的 action.yml 语法详情参考 <a href="https://help.github.com/en/actions/building-actions/metadata-syntax-for-github-actions" target="_blank" rel="noopener noreferrer">Metadata syntax for GitHub Actions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>runs.post 指定后置处理脚本 （截止本文编写的时候，Github Action 官方文档并没有说明 runs.post 不过在 <a href="https://github.com/actions/checkout" target="_blank" rel="noopener noreferrer"><code>actions/checkout</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中却发现了有这样的用法。）</p></blockquote> <h3 id="安装-github-actions-toolkit"><a href="#安装-github-actions-toolkit" class="header-anchor">#</a> 安装 GitHub Actions Toolkit</h3> <p><a href="https://github.com/actions/toolkit" target="_blank" rel="noopener noreferrer">GitHub Actions Toolkit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 Github 提供的一些列开发工具包用于 action 开发，并且提供各种模板有 JavaScript 开发项目模板和 Typescript 项目模板等。</p> <h3 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h3> <h3 id="readme"><a href="#readme" class="header-anchor">#</a> README</h3> <p>创建一个标准的 Action README</p> <p>A detailed description of what the action does.
Required input and output arguments.
Optional input and output arguments.
Secrets the action uses.
Environment variables the action uses.
An example of how to use your action in a workflow.</p> <p><a href="https://help.github.com/en/actions/building-actions/creating-a-javascript-action#create-a-readme" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="代码提交及版本管理"><a href="#代码提交及版本管理" class="header-anchor">#</a> 代码提交及版本管理</h3> <h4 id="release-分支"><a href="#release-分支" class="header-anchor">#</a> release 分支</h4> <h4 id="打包"><a href="#打包" class="header-anchor">#</a> 打包</h4> <p>action 在 workflow 中作为一个单独的运行程序，所以我们需要将它及其依赖一同打包。
<a href="https://github.com/zeit/ncc" target="_blank" rel="noopener noreferrer">zeit/ncc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个快速的零配置且内置支持 typescript 的 node module 打包工具。</p> <div class="language- extra-class"><pre class="language-text"><code>...
&quot;package&quot;: &quot;ncc build index.js -o dist&quot;,
...
</code></pre></div><h3 id="在-workflow-中测试你的-action"><a href="#在-workflow-中测试你的-action" class="header-anchor">#</a> 在 workflow 中测试你的 action</h3> <p>私有 action</p> <h3 id="发布-github-marketplace"><a href="#发布-github-marketplace" class="header-anchor">#</a> 发布 Github Marketplace</h3> <p><a href="https://help.github.com/en/actions/building-actions/publishing-actions-in-github-marketplace" target="_blank" rel="noopener noreferrer">https://help.github.com/en/actions/building-actions/publishing-actions-in-github-marketplace<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Git/使用 GithubPage、GithubAction、VuePress 搭建个人博客.html" class="prev">
        使用 GithubPage、GithubAction、VuePress 搭建个人博客
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bf7dde31.js" defer></script><script src="/assets/js/2.66e7cddf.js" defer></script><script src="/assets/js/4.266dd422.js" defer></script>
  </body>
</html>
