# 身份验证和权限校验

- 身份验证 => 身份标识及信息存储
  - Session 机制
    - Cookie(sessionID)-Session
    - Session 的分布式问题
      - 独立的缓存服务器：共享 session
  - Token 机制
    - 由服务端生成并且客户端存储用户信息，对服务端来说是无状态的，可扩展性好
    - 安全：
      - 尽量不要将涉及到安全数据，或者先进行数据加密
      - 尽可能的使用 HTTPS 协议传输
      - Token 的过期时间也要设置的尽可能短
    - Token 刷新机制
    - [JWT](#jwt)
- SSO：单点登录，一次登录全线通用
  - 核心：单独**认证服务**（通常被称为 SSO）
  - 顶级域相同
    - cookie 顶级域共享 + 共享 session/token
  - 顶级域不同
- OAuth2：授权协议
- 权限设计
  - ACL 即访问控制列表，它的核心在于用户直接和权限挂钩
  - RBAC 核心是用户只和角色关联，而角色对应了权限


对 session 和 token 的对比本质上是「客户端存 cookie / 存别地儿」、「服务端存数据 / 不存数据」的对比。


Cookie-session 局限性

依赖 Cookie，用户可以在浏览器端禁用 Cookie

不支持跨端兼容 app 等

业务系统不停的请求缓存服务器查找用户信息，使得内存开销增加，服务器压力过大

服务器是有状态的，如果是没有缓存服务器的方式，扩容就非常困难，需要在多台服务器中疯狂复制 sessionId

存在单点登录失败的可能性

## JWT

> [JWT](https://jwt.io/)

- JWT Token = header.payload.signature
- Header = base64url({ typ, alg, ...})
  - typ：表示令牌类型，JWT 令牌统一写为 JWT
  - alg：签名算法，默认为 HS256
- Payload = base64url({...})
- Signature = HASH(Header.Payload, secret)