---
release: true
tags:
 - javascript
 - å¼‚æ­¥
 - ç¼–ç¨‹è¯­è¨€
---

# JavaScript å¼‚æ­¥ç¼–ç¨‹

- JavaScript å¼‚æ­¥ç¼–ç¨‹
  - [ä½•ä¸ºå¼‚æ­¥ç¼–ç¨‹](#ä½•ä¸ºå¼‚æ­¥ç¼–ç¨‹)
  - [JavaScript çš„æ‰§è¡Œç¯å¢ƒï¼šäº‹ä»¶å¾ªç¯ + å›è°ƒé˜Ÿåˆ—](#javascript-çš„æ‰§è¡Œç¯å¢ƒäº‹ä»¶å¾ªç¯--å›è°ƒé˜Ÿåˆ—)
  - [JavaScript å¼‚æ­¥ç¼–ç¨‹èŒƒå¼](#javascript-å¼‚æ­¥ç¼–ç¨‹)

## ä½•ä¸ºå¼‚æ­¥ç¼–ç¨‹

**åŒæ­¥/å¼‚æ­¥å…³æ³¨çš„æ˜¯äº‹ç‰©ä¹‹é—´çš„è¡Œä¸ºæ¨¡å¼ã€åä½œå…³ç³»**ï¼šä¸€ä¸ªäº‹ç‰©çš„å‘ç”Ÿå¿…é¡»ç­‰å¾…å¦ä¸€äº‹ç‰©çš„ç»“æœï¼Œè¿™å°±æ˜¯åŒæ­¥ï¼Œåä¹‹äº¦æ˜¯å¼‚æ­¥ï¼Œè¯´æ˜äº‹ç‰©ä¹‹é—´æ²¡æœ‰å› æœé¡ºåºå…³ç³»ï¼Œæ˜¯ç‹¬ç«‹æ€§çš„ã€‚

> å¾ˆå¤šäººå°†åŒæ­¥/å¼‚æ­¥ä¸é˜»å¡/éé˜»å¡æ··æ·†åœ¨ï¼Œå…¶å®é˜»å¡/éé˜»å¡å…³æ³¨ã€æè¿°çš„æ˜¯å¯¹è±¡çŠ¶æ€ï¼Œæ¯”å¦‚è¿›ç¨‹

åŒæ­¥/å¼‚æ­¥æ˜¯ä¸€ç§æœ¯è¯­åœ¨ä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒå±‚é¢çš„æ„æ€ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒåŒæ­¥ç¼–ç¨‹æ„å‘³ç€æŒ‡ä»¤ã€ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹è·Ÿä»£ç çš„ç¼–å†™ã€è°ƒç”¨é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œè€Œå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œä»£ç æ›´å¤šæ˜¯è¢«ç»„ç»‡æˆä¸ºäº†å¼‚æ­¥ä»»åŠ¡å•å…ƒï¼Œä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€å‘ç”Ÿæ—¶æœºä¸å†åƒåŒæ­¥ç¼–ç¨‹é‚£æ ·ç›´è§‚ã€å¯é¢„æµ‹ï¼Œå®ƒä»¬ç»Ÿä¸€ç”±å¼‚æ­¥è¿è¡Œæ—¶å¹¶å‘è°ƒåº¦å¹¶ä¸”é€šè¿‡ç‰¹å®šè¯­æ³•æ¥ç¡®ä¿æ—¶åºå…³ç³»ã€‚

ç¼–ç¨‹è¯­è¨€çš„å¼‚æ­¥ä½“ç³»æ„æˆï¼š

- ç¡¬ä»¶å±‚
- æ“ä½œç³»ç»Ÿè¿›ç¨‹ã€çº¿ç¨‹
- å¼‚æ­¥æ¨¡å‹
- å¼‚æ­¥ç¼–ç¨‹èŒƒå¼

ç¡¬ä»¶å±‚ï¼šæˆ‘ä»¬ä¸–ç•Œçš„äº‹ç‰©æ˜¯åœ¨å¹¶å‘å‘ç”Ÿçš„ï¼Œè®¡ç®—æœºçš„å†…éƒ¨ç¡¬ä»¶åŒæ ·å¦‚æ­¤ã€‚æ¯”å¦‚å¤šä¸ª CPU å¯ä»¥å¹¶è¡Œå·¥ä½œï¼›CPU å¯ä»¥ä¸ IO è®¾å¤‡å¼‚æ­¥å·¥ä½œï¼ŒIO è®¾å¤‡é€šè¿‡ DMA æ–¹å¼ç›´æ¥ä¸å†…å­˜æ‰“äº¤é“ï¼Œç„¶åé€šè¿‡ä¸­æ–­ä¿¡å·åé€šçŸ¥ CPU å†æ¥è¯»å–ç›¸åº”çš„è®¾å¤‡ç¼“å†²åŒºã€‚

æ“ä½œç³»ç»Ÿï¼šå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯åŒæ­¥æ¨¡å‹ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬çš„ç¨‹åºåœ¨è®¡ç®—æœºå†…éƒ¨å´æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œæ“ä½œç³»ç»Ÿä»¥çº¿ç¨‹ä½œä¸ºæœ€å°è°ƒåº¦æ‰§è¡Œå•ä½å¹¶ä¸”åˆ†æ—¶è°ƒåº¦æˆ‘ä»¬çš„ä»£ç ï¼ˆæ“ä½œç³»ç»Ÿä¼šä¿å­˜ä¸Šä¸‹æ–‡åŠæ‰§è¡Œä½ç½®ä»¥ä¾¿æ¢å¤åŸæ¥æ‰§è¡Œï¼‰ï¼Œè¿™å¯¹äºå¼€å‘è€…æ¥è¯´æ˜¯æ— æ„Ÿçš„ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿè¿˜å¸®æˆ‘ä»¬å±è”½ç¡¬ä»¶å±‚é¢çš„å¼‚æ­¥ï¼Œï¼ˆä¸»è¦ï¼‰æä¾›äº†é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ ·çš„ä¸€åˆ‡ä½¿å¾—æˆ‘ä»¬ç¨‹åºè¡¨ç°å‡ºä¸€ç§åŒæ­¥æ‰§è¡Œæ•ˆæœã€‚

å¹¶å‘æ¨¡å‹ï¼šä¸ºäº†ä¿è¯å¹¶å‘ç³»ç»Ÿè®¾è®¡çš„æ­£ç¡®æ€§äººä»¬è¯•å›¾é€šè¿‡å½¢å¼åŒ–çš„æ¨¡å‹æ¥è§„èŒƒå®ƒï¼Œå¹¶å‘æ¨¡å‹ä¸»è¦åˆ†ä¸º**çº¿ç¨‹æ¨¡å‹**å’Œ**å¼‚æ­¥æ¨¡å‹ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰**ï¼Œä»æœ¬è´¨ä¸Šè¯´å…¶å®ä¸¤è€…æ˜¯ç­‰ä»·çš„ï¼Œå®ƒä»¬éƒ½æ˜¯è°ƒåº¦ä»£ç æ‰§è¡Œçš„æ‰‹æ®µï¼Œæˆ–è€…è¯´åœ¨è®¡ç®—æœºé‡Œæ¨¡æ‹Ÿå¹¶å‘æ€§çš„æ‰‹æ®µã€‚åŒºåˆ«ï¼š
- çº¿ç¨‹é€‚åˆå¤„ç†äº‹åŠ¡ä¹‹é—´æœ‰ç€æ˜æ˜¾å› æœå…³ç³»æˆ–è€…ç›¸å…³æ€§å¾ˆå¼ºçš„åœºåˆï¼Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ä¼šæŠŠä»£ç æçš„æ”¯ç¦»ç ´ç¢
- äº‹ä»¶é©±åŠ¨æ¯”è¾ƒæ“…é•¿å¤„ç†å¼‚æ­¥äº‹ä»¶çš„é—®é¢˜ï¼Œä½†å½“éœ€è¦å¤„ç†è·¨äº‹ä»¶çš„äº‹åŠ¡é€»è¾‘æ—¶ï¼Œäº‹ä»¶é©±åŠ¨éƒ½ä¼šå˜å¾—å¤æ‚éš¾è§£ï¼›äº‹åŠ¡é©±åŠ¨æœ‰ä¸€ç‚¹ä¼˜åŠ¿çš„åœ°æ–¹ï¼Œå°±æ˜¯å®ƒä¸ç”Ÿä¿±æ¥çš„å¹¶å‘æ€§å’Œçµæ´»æ€§
- çº¿ç¨‹æ˜¯åˆ†æ—¶è°ƒåº¦æˆ–æŠ¢å å¼è°ƒåº¦æœºåˆ¶ï¼›è€Œäº‹ä»¶é©±åŠ¨æœºåˆ¶åˆ™é‡‡ç”¨å•çº¿ç¨‹äº‹ä»¶å¾ªç¯ã€åç¨‹è¿™æ ·ä¸€ç§åä½œå¼çš„è°ƒåº¦æœºåˆ¶
- ä½¿ç”¨åä½œå¼å¤šä»»åŠ¡å¤„ç†çš„åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹éš¾ç‚¹åœ¨äºï¼Œåˆ‡æ¢å¤„ç†ï¼Œä¿æŒä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè¿™äº›èŒè´£éƒ½è½åœ¨äº†å¯æ€œçš„å¼€å‘è€…è‚©ä¸Šäº†æˆ–è€…ç”±ç¼–ç¨‹è¯­è¨€å»å®ç°å¼‚æ­¥è¿è¡Œæ—¶å’Œç¼–ç¨‹èŒƒå¼ï¼›è€Œçº¿ç¨‹æ¨¡å‹åˆ™ç”±æ“ä½œç³»ç»Ÿè‡ªå¸¦

é‚£ä¹ˆå¼‚æ­¥ç¼–ç¨‹ç›¸æ¯”åŒæ­¥ç¼–ç¨‹ç©¶ç«Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹å¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§ï¼Œç›¸å½“äºæé«˜ç³»ç»Ÿçš„å“åº”æ€§å’Œèµ„æºåˆ©ç”¨ç‡ã€‚

ä»»åŠ¡ä¸€èˆ¬åˆ†ä¸º IO å¯†é›†å‹å’Œ CPU å¯†é›†å‹ã€‚è€Œ web é¢†åŸŸæ˜¯ä¸€ä¸ª IO å¯†é›†çš„åœºæ™¯ï¼šä¸»æµçš„å¤šçº¿ç¨‹å¹¶å‘æ–¹æ¡ˆä¸ä»…è¦é¢å¯¹ç«äº‰æ¡ä»¶ã€æ­»é”ç­‰ç¼–ç¨‹é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯ç»å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½å¤„åœ¨ç­‰å¾…ç½‘ç»œå“åº”æˆ–è€…ç­‰å¾…ç£ç›˜è¯»å–ä¸­ï¼ŒCPU çš„åˆ©ç”¨ç‡ä¾ç„¶å¾ˆä½ï¼Œè€Œä¸”å¤§éƒ¨åˆ† CPU éƒ½è€—åœ¨æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ä¸Šäº†ï¼›è€Œä¸”çº¿ç¨‹ä¹Ÿæ˜¯èµ„æºï¼Œå®ƒä»¬ä¸æ˜¯å…è´¹çš„ï¼Œç³»ç»Ÿæœ‰æ•°é‡é™åˆ¶ã€‚

**å¼‚æ­¥ç¼–ç¨‹ä¸»è¦æ˜¯è§£å†³ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—é—®é¢˜ï¼Œæé«˜ CPU åˆ©ç”¨ç‡**ã€‚  

**å¼‚æ­¥ç¼–ç¨‹æœ¬è´¨ä¸Šæ˜¯å¸¦æœ‰ç”¨æˆ·ç©ºé—´çº¿ç¨‹çš„åä½œå¼å¤šä»»åŠ¡å¤„ç†æœºåˆ¶**ï¼Œåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·ç©ºé—´ä¸­ç®¡ç†"çº¿ç¨‹"å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç”±ç”¨æˆ·ç¨‹åºè‡ªè¡Œä»»åŠ¡è°ƒåº¦é¿å…äº†**é˜»å¡åŸæ¥çº¿ç¨‹ï¼ŒCPU åœ¨çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—**ã€‚

> åä½œå¼çš„æ ¸å¿ƒæ˜¯â€œä¸»åŠ¨â€åè°ƒï¼šæˆ‘ä¸æ”¾å¼ƒæ‰§è¡Œæƒï¼Œä»»ä½•äººä¸èƒ½å¼ºåˆ¶æˆ‘ä¼‘çœ ï¼›æˆ‘åšå®Œäº†è‡ªå·±çš„å·¥ä½œï¼Œé‚£å°±ä¸€å®šè¦ä¸»åŠ¨æ”¾å¼ƒæ‰§è¡Œæƒï¼Œæ–¹ä¾¿å…¶å®ƒäººä½¿ç”¨CPUå·¥ä½œã€‚

æ€»ç»“æ¥è¯´ï¼Œå¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œ**ä»»åŠ¡åªæœ‰å…·å¤‡å¼‚æ­¥ç‰¹æ€§æ‰èƒ½è¢«å¹¶å‘æ‰§è¡Œ**ï¼Œä½†ä¿è¯å•ä¸ªäº‹åŠ¡çš„è¿ç»­æ€§ï¼ˆä»£ç æ˜¯å¯å¼‚æ­¥æ‰§è¡Œï¼Œä½†ä¸šåŠ¡é€»è¾‘å¿…é¡»æ˜¯åŒæ­¥å…³ç³»ï¼‰æ˜¯ç¼–ç¨‹ä¸­**å¼‚æ­¥å¤„ç†**çš„å…³é”®è§£å†³ä¹‹é“ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ JavaScript å¼‚æ­¥ç¼–ç¨‹ä¸­çš„å¼‚æ­¥è¿è¡Œæ—¶å’Œç¼–ç¨‹èŒƒå¼ã€‚

## JavaScript çš„æ‰§è¡Œæ¨¡å‹ï¼šå•çº¿ç¨‹äº‹ä»¶å¾ªç¯ + å›è°ƒé˜Ÿåˆ—

JavaScript æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€ï¼Œæ„å‘³ç€è¯­è¨€æ²¡æœ‰æä¾›å¤šçº¿ç¨‹èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿè·Ÿå¤§å¤šæ•°è¯­è¨€ä¸€æ ·éƒ½æ˜¯é»˜è®¤åŒæ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œä¸€æ—¦é‡åˆ°è€—æ—¶ä»»åŠ¡æ•´ä¸ªçº¿ç¨‹å°±ä¼šè¢«åŒæ­¥é˜»å¡ã€‚

åœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript è¯­è¨€æœ¬èº«å¹¶æ²¡æœ‰ä»»ä½•å¼‚æ­¥èƒ½åŠ›ï¼Œ
å¯¹äº JavaScript æ¥è¯´ï¼Œè€—æ—¶ä»»åŠ¡çš„å¼‚æ­¥åŒ–ä¸»è¦ç”±æ‰§è¡Œç¯å¢ƒæä¾›çš„å¼‚æ­¥ APIï¼Œå¹¶ä¸”åœ¨å¼‚æ­¥å¤„ç†ä¸Šåˆ™é€šè¿‡å¼‚æ­¥å›è°ƒçš„èŒƒå¼ã€‚å¯ä»¥è¯´åœ¨ç¼–ç¨‹å±‚é¢ï¼Œ**JavaScirpt å¼‚æ­¥ = å¼‚æ­¥ API + å¼‚æ­¥å›è°ƒ**çš„æ¨¡å¼ã€‚

ä½†å¯¹äºè¿™æ ·çš„æ¨¡å¼ï¼Œåœ¨æ‰§è¡Œç¯å¢ƒå±‚é¢æ˜¯å¦‚ä½•æ”¯æŒï¼Ÿæˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤çŸ¥ï¼šä¸€ä¸ª JavaScript å¼•æ“ä¼šå¸¸é©»äºå†…å­˜ä¸­ï¼Œå®ƒç­‰å¾…ç€å®¿ä¸»ç¯å¢ƒæŠŠ JavaScript ä»£ç æˆ–è€…å‡½æ•°ä¼ é€’ç»™å®ƒæ‰§è¡Œã€‚ES5 ä¹‹åï¼ŒJavaScript å¼•å…¥äº† Promiseï¼Œè¿™æ ·ï¼Œä¸éœ€è¦å®¿ä¸»çš„å®‰æ’ä»»åŠ¡ï¼ŒJavaScript å¼•æ“æœ¬èº«ä¹Ÿå¯ä»¥å‘èµ·ä»»åŠ¡äº†ã€‚æˆ‘ä»¬æŠŠå®¿ä¸»å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå®è§‚ä»»åŠ¡ï¼ŒæŠŠ JavaScript å¼•æ“å‘èµ·çš„ä»»åŠ¡ç§°ä¸ºå¾®è§‚ä»»åŠ¡ã€‚

æ•´ä¸ªæ‰§è¡Œæ¨¡å‹æ˜¯ä¸€ä¸ªå•çº¿ç¨‹äº‹ä»¶å¾ªç¯ + å›è°ƒé˜Ÿåˆ—ï¼š

> ä»¥ä¸‹æ˜¯æµè§ˆå™¨äº‹ä»¶å¾ªç¯æ¨¡å‹ä¸­ JavaScript äº¤äº’çš„éƒ¨åˆ†

![](./images/1*iHhUyO4DliDwa6x_cO5E3A.gif)

## JavaScript å¼‚æ­¥ç¼–ç¨‹èŒƒå¼

> ç½‘ä¸Šå¯¹ JavaScript å¼‚æ­¥ç¼–ç¨‹èŒƒå¼ä»‹ç»æœ‰å¾ˆå¤šå¾ˆè¯¦ç»†çš„ï¼Œç¬”è€…å¯¹äºè¿™å—å†…å®¹å°±æŒ‘ç€è®°å½• ğŸ˜Š

- JavaScript å¼‚æ­¥ç¼–ç¨‹èŒƒå¼å¯¹æ¯”
  - Callback
    - å›è°ƒåœ°ç‹±
    - åˆ†æµç»“æœå¤„ç†ï¼šæ¯ç§ä»»åŠ¡çš„å¤„ç†ç»“æœå­˜åœ¨ä¸¤ç§å¯èƒ½æ€§ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œé‚£ä¹ˆéœ€è¦åœ¨æ¯ç§ä»»åŠ¡æ‰§è¡Œç»“æŸååˆ†åˆ«å¤„ç†è¿™ä¸¤ç§å¯èƒ½æ€§
  - å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†å­˜æœ‰é€»è¾‘ç¢ç‰‡åŒ–çš„é—®é¢˜
    - [æ‰‹å†™ EventEmitter å®ç°](https://github.com/laoergege/laoergege-blog/issues/84)
  - [Promise](#promise)ï¼šé€šè¿‡é“¾å¼è°ƒç”¨çš„å†™æ³•ä¸ä»…è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œè€Œä¸”çº¿å‹ç®¡ç† Callback çš„æ–¹å¼ä½¿å¾—ç›¸å…³é€»è¾‘å†…èšæé«˜äº†ä¸€å®šçš„å¯è¯»æ€§
    - [Promise å¼‚æ­¥é”™è¯¯](#promise-å¼‚æ­¥é”™è¯¯)
  - [Generator](#generator--åç¨‹)
  - Async/Awaitï¼šæœ¬è´¨ä¸Šæ˜¯ promise + generator å¼‚æ­¥æ–¹æ¡ˆæ ‡å‡†åŒ–
    - [Async/Await å®ç°åŸç†](#asyncawait-å®ç°åŸç†)
  - å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼šæ˜¯ä¸€ç§å‘å¸ƒè®¢é˜…æ¨¡å¼å’Œè¿­ä»£æ¨¡å¼çš„ç»“åˆï¼Œç›¸æ¯”å‘å¸ƒè®¢é˜…æ¨¡å¼å¸¦æ¥äº‹ä»¶æ”¯ç¦»ï¼Œå‡½æ•°å“åº”å¼ç¼–ç¨‹åˆ™æŠŠå®ƒä»¬ä¸²è¿èµ·æ¥ï¼Œå½“ä½œäº‹ä»¶æµæ¥å¤„ç†

### Promise

Promise ä»£è¡¨ç€ä¸€ç§æœªæ¥çš„æ‰¿è¯ºï¼Œæœ¬è´¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥çœ‹ä½œæ˜¯çŠ¶æ€æœºå’Œè§‚å¯Ÿè€…æ¨¡å¼ç»“åˆã€‚

> [Promises/A+ è§„èŒƒé“¾æ¥åœ°å€](https://promisesaplus.com/)

- Promise å®ä¾‹
  - state  ![å›¾ 2](./images/1654329152719.png)  
    - pending
    - fulfilled
    - rejected
  - result
  - reason: æ˜¯ä¸€ä¸ª Promise é‡Œ reject ä¹‹åè¿”å›çš„æ‹’ç»åŸå› 
  - exception: æ˜¯ä¸€ä¸ªå¼‚å¸¸ï¼Œæ˜¯åœ¨ Promise é‡Œé¢å¯ä»¥ç”¨ throw è¯­å¥æŠ›å‡ºæ¥çš„å€¼
  - thenã€catchã€finally
    - é“¾å¼è°ƒç”¨
    - å»¶è¿Ÿç»‘å®š
    - å€¼ç©¿é€ã€é”™è¯¯å†’æ³¡ï¼šå½“æˆ‘ä»¬ä¸åœ¨ then ä¸­æ”¾å…¥å‚æ•°ï¼Œæˆ–è€…å‚æ•°ä¸ä¸º functionï¼Œä¾‹ï¼špromise.then().then()ï¼Œé‚£ä¹ˆå…¶åé¢çš„ then ä¾æ—§å¯ä»¥å¾—åˆ°ä¹‹å‰ then è¿”å›çš„å€¼
    - è¿”å›å€¼ç©¿é€ï¼šresolve è¿”å›å€¼ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ Promiseï¼Œåˆ™ç›´æ¥è·å–å†…éƒ¨ç»“æœè¿”å›
    - onResolved å’Œ onRejected è¿™ä¸¤é¡¹å‡½æ•°éœ€è¦å¼‚æ­¥è°ƒç”¨
- Promise é™æ€æ–¹æ³•
  - **resolve**
    - å‚æ•°ä¸º Promise å¯¹è±¡ï¼Œç›´æ¥è¿”å›
    - å‚æ•°ä¸º Thenable å¯¹è±¡
    - å…¶ä»–æ•°æ®ç±»å‹ï¼Œä½œä¸ºæ–° Promise çš„ result
  - reject
  - allï¼šæ‰€æœ‰ Promises çŠ¶æ€æˆåŠŸå°±è¿”å›ï¼Œå¦åˆ™è¿”å›å¤±è´¥çš„ Promises
  - allSettledï¼šæ‰€æœ‰çš„ Promise çŠ¶æ€å®Œæˆå°±è¿”å›ï¼Œä¸ç®¡å…¶æ˜¯å¦å¤„ç†æˆåŠŸ
  - anyï¼šä¼˜å…ˆè¿”å›çŠ¶æ€æˆåŠŸçš„ Promiseï¼Œå¦åˆ™è¿”å›å…¨éƒ¨å¤±è´¥ç»“æœ
  - raceï¼šä¼˜å…ˆè¿”å›ä¼˜å…ˆå®Œæˆçš„ Promise

é€šè¿‡æ‰‹å†™å®ç° Promiseã€å¼‚æ­¥é¡ºåºè€ƒç‚¹å»æ›´å¥½äº†è§£ Promise æœºåˆ¶å§ ğŸ˜˜

> [100 è¡Œä»£ç å®ç° Promises/A+ è§„èŒƒ](https://zhuanlan.zhihu.com/p/83965949)

> [ ğŸ˜˜ ç¬”è€…å®ç°çš„ç®€æ˜“ç‰ˆæœ¬ promise.js](https://github.com/laoergege/laoergege-blog/blob/master/docs/JavaScript/codes/promise.js)

> [å¼‚æ­¥é¡ºåºè€ƒç‚¹](https://github.com/laoergege/laoergege-blog/issues/81)

### Promise å¼‚æ­¥é”™è¯¯

æˆ‘ä»¬æŠŠ Promise å½“ä½œç€ä¸€ç§å¼‚æ­¥ç»“æœï¼Œå½“äº§ç”Ÿé”™è¯¯æ—¶ï¼Œè‡ªç„¶ä¸ä¼šæŠ›å‡ºåŸ Promise ä»£ç å¤–éƒ¨ï¼Œå› ä¸ºè¯­è¨€çš„å¼‚å¸¸æœºåˆ¶éœ€è¦åœ¨åŒä¸€è°ƒç”¨æ ˆä¸­æ‰èƒ½è¢«æ•è·,è€Œå¼‚æ­¥ä»£ç çš„æ‰§è¡Œå‘ç”Ÿæ˜¯åœ¨å¦ä¸€ä¸ªè°ƒç”¨æ ˆã€‚

```js
try {
  new Promise((resolve, reject) => {
    throw new Error("Whoops!");
  }).catch(alert); // Error: Whoops!
} catch(error) {
  console.log(error) // no happend
}
```

ä½†å®é™…ä¸Š JavaScirpt Promise çš„æ‰§è¡Œè€…ï¼ˆexecutorï¼‰æ˜¯åŒæ­¥æ‰§è¡Œï¼Œè€Œå¤„ç†ç¨‹åºï¼ˆhandlerï¼‰æ˜¯å¼‚æ­¥æ‰§è¡Œã€‚Promise çš„æ‰§è¡Œè€…ï¼ˆexecutorï¼‰å’Œ promise çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰å‘¨å›´æœ‰ä¸€ä¸ªâ€œéšå¼çš„ try..catchâ€ã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå®ƒå°±ä¼šè¢«æ•è·ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŒåœ¨è¯­ä¹‰ä¸Šç›¸åŒäº†ã€‚

å†çœ‹ä¸€ç§æƒ…å†µï¼š

```js
new Promise(function(resolve, reject) {
  setTimeout(() => {
    throw new Error("Whoops!");
  }, 1000);
}).catch(alert);
```

ä¸Šé¢çš„é”™è¯¯ä¸ä¼šè¢« Promise æ•è·ï¼ŒsetTimeout ä¹Ÿæ˜¯ä¸€ç§å¼‚æ­¥æ“ä½œï¼Œæ•…ä¸åœ¨ Promise çš„å¼‚æ­¥å†…éƒ¨è‡ªç„¶æ— æ³•æ•è·ã€‚

JavaScript å¼•æ“ä¼šè·Ÿè¸ªæœªå¤„ç†çš„ rejectionï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šç”Ÿæˆä¸€ä¸ªå…¨å±€çš„ errorï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ unhandledrejection äº‹ä»¶æ¥æ•è·è¿™ç±» errorï¼š

```js
window.addEventListener('unhandledrejection', function(event) {
  // è¿™ä¸ªäº‹ä»¶å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š
  alert(event.promise); // [object Promise] - ç”Ÿæˆè¯¥å…¨å±€ error çš„ promise
  alert(event.reason); // Error: Whoops! - æœªå¤„ç†çš„ error å¯¹è±¡
});

new Promise(function() {
  throw new Error("Whoops!");
}); // æ²¡æœ‰ç”¨æ¥å¤„ç† error çš„ catch
```

### Generator & åç¨‹

JavaScript ä¸­çš„ Generator æ˜¯ä¸€ç§æ— æ ˆåç¨‹ï¼šåç¨‹æ²¡æœ‰è‡ªå·±çš„è°ƒç”¨æ ˆï¼ŒæŒ‚èµ·ç‚¹çš„çŠ¶æ€é€šè¿‡**çŠ¶æ€æœº**å’Œ**é—­åŒ…**ç­‰è¯­æ³•æ¥å®ç°ï¼›è€Œæœ‰æ ˆåç¨‹ï¼šæ¯ä¸ªåç¨‹éƒ½æœ‰è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œç±»ä¼¼äºçº¿ç¨‹çš„è°ƒç”¨æ ˆã€‚

æ— æ ˆåç¨‹å°±æ„å‘³ç€æ— æ³•åœ¨å†…éƒ¨å‡½æ•°ä¸­æŒ‚èµ·åç¨‹

```js
function *test() {
  console.log('execution start');
  
  ['A', 'B'].forEach(function(item) {
    yield item; // Uncaught SyntaxError: Unexpected identifier
  })
}

const t = test()
t.next()
```

### Async/Await å®ç°åŸç†

Async/Await å…¶å®åªæ˜¯è¯­æ³•ç³–ï¼Œæœ¬è´¨ä¸Šæ˜¯æŠŠ Async å‡½æ•°ç¼–è¯‘æˆ Generator å‡½æ•°å’Œç”Ÿæˆä¸€ä¸ªåŸºäº Promise çš„ Generator å‡½æ•°è‡ªåŠ¨æ‰§è¡Œå™¨å»è¿­ä»£å®Œ Generator å‡½æ•°ã€‚

```js
function _async(gen) {
  const g = gen()
  return new Promise((resolve, reject) => {
    const next = function(res) {
      try {
        let { value, done } = g.next(res);
        if(done) {
          resolve(value) 
        } else {
          Promise
            .resolve(value) // promise.resolve è§£æç»“æœå¹¶å¯æ•è· Promise å¼‚æ­¥é”™è¯¯è¿›è¡ŒåŒæ­¥å¤„ç†
            .then(next, (err) => g.throw(err)) // é€šè¿‡ promise.then ä¸æ–­è°ƒ generator.next ç›´åˆ° done
        }
      } catch (error) {
        reject(error)
      }
    };
    next();
  });
}

function* g() {
  let res = yield 1;
  const fn = () => Promise.reject(2)
  try {
    res += yield fn();
  } catch (error) {
    console.log("error: " + error);
  }
  return res;
}

// æ‰§è¡Œ
_async(g)
```

æŠŠç”Ÿæˆå™¨ g è·Ÿ async å‡½æ•°ç‰ˆæœ¬å¯¹æ¯”ä¸€ä¸‹ï¼Œä¸å°±æ˜¯ï¼š

- function* æ¢æˆ async
- yield æ¢æˆ await

```js
async function g() {
  let res = await 1;
  const fn = () => { throw 2 }
  res += await fn();
  return res;
}
```

å¯¹æ¯”ä¸‹ Babel ç¼–è¯‘ç”Ÿæˆçš„ä»£ç ï¼š

```js
"use strict";

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  try {
    var info = gen[key](arg);
    var value = info.value;
  } catch (error) {
    reject(error);
    return;
  }
  if (info.done) {
    resolve(value);
  } else {
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) {
  return function () {
    var self = this,
      args = arguments;
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);
      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
      }
      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
      }
      _next(undefined);
    });
  };
}

function g() {
  return _g.apply(this, arguments);
}

function _g() {
  _g = _asyncToGenerator(function* () {
    let res = yield 1;

    const fn = () => {
      throw 2;
    };

    res += yield fn();
    return res;
  });
  return _g.apply(this, arguments);
}
```

## å­¦ä¹ å‚è€ƒ

- [ä»æ ¹æœ¬ä¸Šäº†è§£å¼‚æ­¥ç¼–ç¨‹ä½“ç³»](https://zhuanlan.zhihu.com/p/434361727)
- [ç™½è¯å¹¶å‘æ¨¡å‹å’Œå¼‚æ­¥ç¼–ç¨‹èŒƒå¼](https://code2life.top/2021/05/31/0062-concurrent-model-async-programming/)
- [å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼šäº‹ä»¶é©±åŠ¨ vs çº¿ç¨‹](https://zhuanlan.zhihu.com/p/32961438)
- [Asynchronous programming. Blocking I/O and non-blocking I/O](https://luminousmen.com/post/asynchronous-programming-blocking-and-non-blocking)
- [ä½¿ç”¨ promise è¿›è¡Œé”™è¯¯å¤„ç†](https://zh.javascript.info/promise-error-handling)
-  é˜®ä¸€å³°ã€Šæ·±å…¥æŒæ¡ ECMAScript 6 å¼‚æ­¥ç¼–ç¨‹ã€‹