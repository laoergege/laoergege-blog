<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | Laoergege Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Just For Fun">
    <link rel="preload" href="/assets/css/0.styles.1ffd35d4.css" as="style"><link rel="preload" href="/assets/js/app.dae2a0e7.js" as="script"><link rel="preload" href="/assets/js/2.e60de17f.js" as="script"><link rel="preload" href="/assets/js/46.434193ec.js" as="script"><link rel="prefetch" href="/assets/js/10.93edab0b.js"><link rel="prefetch" href="/assets/js/11.bcc5b4c2.js"><link rel="prefetch" href="/assets/js/12.22a42d99.js"><link rel="prefetch" href="/assets/js/13.97b450cb.js"><link rel="prefetch" href="/assets/js/14.e133b536.js"><link rel="prefetch" href="/assets/js/15.549bde09.js"><link rel="prefetch" href="/assets/js/16.f1c991ed.js"><link rel="prefetch" href="/assets/js/17.18528d5e.js"><link rel="prefetch" href="/assets/js/18.9ce2968d.js"><link rel="prefetch" href="/assets/js/19.18079adf.js"><link rel="prefetch" href="/assets/js/20.5fa9eb4f.js"><link rel="prefetch" href="/assets/js/21.1439c30f.js"><link rel="prefetch" href="/assets/js/22.a0c2b490.js"><link rel="prefetch" href="/assets/js/23.b75b0ca8.js"><link rel="prefetch" href="/assets/js/24.43fa0106.js"><link rel="prefetch" href="/assets/js/25.9cf57d55.js"><link rel="prefetch" href="/assets/js/26.c095429e.js"><link rel="prefetch" href="/assets/js/27.411bf723.js"><link rel="prefetch" href="/assets/js/28.b27129b0.js"><link rel="prefetch" href="/assets/js/29.98477865.js"><link rel="prefetch" href="/assets/js/3.bc9b7085.js"><link rel="prefetch" href="/assets/js/30.0d651fea.js"><link rel="prefetch" href="/assets/js/31.7c12117f.js"><link rel="prefetch" href="/assets/js/32.edd7e561.js"><link rel="prefetch" href="/assets/js/33.088b0921.js"><link rel="prefetch" href="/assets/js/34.8f2843d0.js"><link rel="prefetch" href="/assets/js/35.9e49781f.js"><link rel="prefetch" href="/assets/js/36.80ed8438.js"><link rel="prefetch" href="/assets/js/37.4edee204.js"><link rel="prefetch" href="/assets/js/38.fe375270.js"><link rel="prefetch" href="/assets/js/39.601f506d.js"><link rel="prefetch" href="/assets/js/4.fdde9a22.js"><link rel="prefetch" href="/assets/js/40.bec46cf7.js"><link rel="prefetch" href="/assets/js/41.412089e1.js"><link rel="prefetch" href="/assets/js/42.7db23644.js"><link rel="prefetch" href="/assets/js/43.f17ad6be.js"><link rel="prefetch" href="/assets/js/44.47614e67.js"><link rel="prefetch" href="/assets/js/45.94817ac3.js"><link rel="prefetch" href="/assets/js/47.d3713dae.js"><link rel="prefetch" href="/assets/js/48.6a4ad6a3.js"><link rel="prefetch" href="/assets/js/5.71acc95f.js"><link rel="prefetch" href="/assets/js/6.57ee5658.js"><link rel="prefetch" href="/assets/js/7.738bb280.js"><link rel="prefetch" href="/assets/js/8.b04a9dcd.js"><link rel="prefetch" href="/assets/js/9.0b983726.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1ffd35d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Laoergege Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaScript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架及库" class="dropdown-title"><span class="title">前端框架及库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/RxJS/" class="nav-link">
  RxJS
</a></li></ul></div></div><div class="nav-item"><a href="/前端工程/" class="nav-link">
  前端工程
</a></div><div class="nav-item"><a href="/浏览器原理及API/" class="nav-link">
  浏览器原理及API
</a></div><div class="nav-item"><a href="/NodeJS/" class="nav-link">
  NodeJS
</a></div><div class="nav-item"><a href="/Git/" class="nav-link">
  Git
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JavaScript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架及库" class="dropdown-title"><span class="title">前端框架及库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/RxJS/" class="nav-link">
  RxJS
</a></li></ul></div></div><div class="nav-item"><a href="/前端工程/" class="nav-link">
  前端工程
</a></div><div class="nav-item"><a href="/浏览器原理及API/" class="nav-link">
  浏览器原理及API
</a></div><div class="nav-item"><a href="/NodeJS/" class="nav-link">
  NodeJS
</a></div><div class="nav-item"><a href="/Git/" class="nav-link">
  Git
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>阅读 <a href="#">JavaScript 高级程序设计/离线应用与客户端存储</a>
离线 web 应用：即使不能上网的情况下，应用还能运行。开发一个能够离线运行 web 应用首要两点：</p> <ul><li>确定设备是否能上网，以便执行相应的操作</li> <li>缓存应用文件及数据，以便应用能够访问一定资源</li></ul> <h3 id="离线检测"><a href="#离线检测" class="header-anchor">#</a> 离线检测</h3> <p><strong>Navigator</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>online<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 正常工作</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">// 执行离线任务</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为了检测应用是否离线，在页面加载后，最好先通过 navigator.onLine 取得初始状态，然后监听离线事件，确认网络连接状态是否变化。</p> <div class="language- extra-class"><pre class="language-text"><code>window.addEventListener('online/offline', () =&gt; {alert('onLine')})
</code></pre></div><h3 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h3> <h4 id="http-cache-之强缓存、协商缓存"><a href="#http-cache-之强缓存、协商缓存" class="header-anchor">#</a> http-cache 之强缓存、协商缓存</h4> <p>阅读</p> <ul><li><a href="https://mp.weixin.qq.com/s/d2zeGhUptGUGJpB5xHQbOA" target="_blank" rel="noopener noreferrer">彻底理解浏览器的缓存机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/yf0pWRFM7v9Ru3D9_JhGPQ" target="_blank" rel="noopener noreferrer">浏览器缓存机制剖析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>当浏览器请求资源时，会先进行缓存查看，若强缓存策略（Expires 和 Cache-control）生效则直接使用缓存。若不生效则进行协商缓存策略（Last-Modified / If-Modified-Since 和 Etag / If-None-Match）,由服务器进行缓存验证，若协商缓存失效，那么代表该请求的缓存失效，重新获取请求结果，再存入浏览器缓存中；生效则返回304，继续使用缓存。</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/meG6Vo0Mevgq38cXiaLvaxNIiatrA806UA6eZ3dqoKdgIhPENicUjaXXict6LuQDYsGNHFrddiayooqibHN50ZUCbYog/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p> <h4 id="cookie、storage"><a href="#cookie、storage" class="header-anchor">#</a> Cookie、Storage</h4> <p>阅读 <a href="https://github.com/amandakelake/blog/issues/13" target="_blank" rel="noopener noreferrer">缓存（三）——数据存储：cookie、Storage、indexedDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h5 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h5> <p>Cookie 是存储在客户端的一小段信息，会自动随着同源请求发送到服务器，内容包括：名字、值、域、路径、时间、大小。
路径与域一起构成cookie的作用范围，cookie可以通过设置domain属性值，设置了 HttpOnly 属性的 cookie 不能使用 JavaScript 设置 Document.cookie 属性。</p> <p>常用的配置属性有以下几个</p> <ul><li>Expires ：cookie最长有效期</li> <li>Max-Age：在 cookie 失效之前需要经过的秒数。（当Expires和Max-Age同时存在时，文档中给出的是已Max-Age为准，可是我自己用Chrome实验的结果是取二者中最长有效期的值）</li> <li>Domain：指定 cookie 可以送达的主机名。</li> <li>Path：指定一个 URL 路径，这个路径必须出现在要请求的资源的路径中才可以发送 Cookie 首部</li> <li>Secure：一个带有安全属性的 cookie 只有在请求使用SSL和HTTPS协议的时候才会被发送到服务器。</li> <li>HttpOnly:设置了 HttpOnly 属性的 cookie 不能使用 JavaScript 经由 Document.cookie 属性、XMLHttpRequest 和 Request APIs 进行访问，以防范跨站脚本攻击（XSS）。</li></ul> <h6 id="javascritpt-中的-cookie-操作"><a href="#javascritpt-中的-cookie-操作" class="header-anchor">#</a> JavaScritpt 中的 cookie 操作</h6> <p><code>document.cookie</code> 能够获取仅对当前页面可用的 cookie （根据 cookie 的 demian、path、失效时间、secure），结果如下</p> <div class="language- extra-class"><pre class="language-text"><code>name1=value1;name2=value2
</code></pre></div><p>所有的名字和值都是经过 URI 编码的，所以在获取或者设置的时候分别使用 decodeURIComponent 和 ecodeURIComponent 来解码或编码。</p> <p>当设置新的 cookie 时</p> <div class="language- extra-class"><pre class="language-text"><code>document.cookie = encodeURIComponent(&quot;name&quot;) + '=' + encodeURIComponent(&quot;value&quot;)
</code></pre></div><p>这个结果值会被解析添加到原来 cookie 集合中，当 name 值与原有的 cookie 一样时，就会覆盖该 cookie。</p> <h5 id="localstorage，sessionstorage"><a href="#localstorage，sessionstorage" class="header-anchor">#</a> localStorage，sessionStorage</h5> <p>localStorage，sessionStorage 明文方式存储字符串内容，api：setItem、getItem、removeItem、key、clear</p> <p>监听storage事件：</p> <div class="language- extra-class"><pre class="language-text"><code>window.addEventListener('storage',function(e){
   console.log('key='+e.key+',oldValue='+e.oldValue+',newValue='+e.newValue);
})
</code></pre></div><h5 id="localstorage，sessionstorage和cookie的区别"><a href="#localstorage，sessionstorage和cookie的区别" class="header-anchor">#</a> localStorage，sessionStorage和cookie的区别</h5> <ul><li>相同：保存在浏览器，有同源策略</li> <li>区别：
<ul><li>大小
<ul><li>cookie 不能超过4K</li> <li>localStorage，sessionStorage 不能超 5M</li></ul></li> <li>生命周期
<ul><li>cookie 可以设置过期时间</li> <li>sessionStorage 仅在当前浏览器窗口关闭之前有效</li> <li>localStorage 长期存储</li></ul></li> <li>作用域
<ul><li>sessionStorage 在当前浏览器窗口共享</li> <li>cookie、localstorage 在同源窗口共享</li></ul></li> <li>其他
<ul><li>cookie数据始终在同源的http请求中携带（即使不需要），即cookie在浏览器和服务器间来回传递，而sessionStorage和localStorage不会自动把数据发送给服务器，仅在本地保存。cookie数据还有路径（path）的概念，可以限制cookie只属于某个路径下</li></ul></li></ul></li></ul> <hr> <!----></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dae2a0e7.js" defer></script><script src="/assets/js/2.e60de17f.js" defer></script><script src="/assets/js/46.434193ec.js" defer></script>
  </body>
</html>
