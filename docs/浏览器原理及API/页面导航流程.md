

## 从输入一个 url 地址到页面的过程

1. 用户输入处理  
   浏览器进程处理用户输入，将 URL 转发给网络进程
2. 导航阶段
   1. http 请求流程
      1. 重定向
      2. 请求排队（请求数限制）
      3. 缓存查找
      4. DNS 
      5. 建立 TCP 连接
      6. 建立 TSL 连接（https，可选）
      7. 发送请求
      8. 处理响应
         1. 重定向，回 2.1.
         2. Content-Type 响应数据类型处理
            1. 通知浏览器准备渲染进程 （跳 3.）
            2. application/octet-stream 通知下载器下载文件，导航结束
      9.  断开 TCP 连接
   2. 提交导航  
      浏览器会发出“提交文档”消息给渲染进程，渲染进程收到消息后，会和网络进程建立传输数据的“管道”后，渲染进程会返回“确认提交”的消息给浏览器进程，浏览器进程接收到确认消息后更新浏览器界面状态，完成导航。
3. 页面渲染

## 网络请求性能优化

Timing

![](./images/timing.png)

- http 缓存
- 排队（Queuing）时间过久
  - 页面资源优先级
  - 域名请求数限制（http/1.1 浏览器为每个域名最多维护 6 个连接导致的）
    - 域名分片
    - 打包请求内容
      - 雪碧图
    - http/2.0（没有域名限制、多路复用）
- 第一字节时间（TTFB）时间过久
  - 网络因素
    - CDN
  - 服务器响应过慢（TTFB 是反映服务端响应速度的重要指标，对服务器来说，TTFB 时间越短，就说明服务器响应越快）
- Content Download 时间过久
  - 传输字节数过多
    - 压缩、去掉不必要的注释
    - tree-shaking 去掉不必要的代码
    - 分包、懒加载


那详细的流程是怎样的呢？网络进程接收到响应头之后，会根据响应头中的 content-type 字段来判断文件的类型，比如 content-type 的值是“text/html”，那么浏览器就会判断这是一个 HTML 类型的文件，然后为该请求选择或者创建一个渲染进程。渲染进程准备好之后，网络进程和渲染进程之间会建立一个共享数据的管道，网络进程接收到数据后就往这个管道里面放，而渲染进程则从管道的另外一端不断地读取数据，并同时将读取的数据“喂”给 HTML 解析器。你可以把这个管道想象成一个“水管”，网络进程接收到的字节流像水一样倒进这个“水管”，而“水管”的另外一端是渲染进程的 HTML 解析器，它会动态接收字节流，并将其解析为 DOM。