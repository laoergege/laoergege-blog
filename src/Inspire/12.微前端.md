

## Why Not Iframe

- CSS 问题（视窗大小不同步）
- url 同步问题
- 子应用通信（使用postMessage并不友好）
- 组件不能共享
- 使用创建 iframe，可能会对性能或者内存造成影响

https://www.yuque.com/kuitos/gky7yw/gesexv

## 微前端核心设计

### 沙箱机制

- JS 作用域隔离
- CSS 样式隔离

- qiankun

  qiankun 实际上是**微前端的运行时容器**

  - 应用生命周期管理

    - 加载
      - 对接协议
      - HTML Entry
    - 装载
    - 卸载

  - 隔离

    - JS 沙箱

      - window diff
      - window proxy 记录操作
      - window proxy 代理操作

    - CSS 隔离
      
      - 工程角度
      
        ![图片](${images}/640)
      
      - Shadow DOM
      
      - web component
      
        - https://lit-element.polymer-project.org/guide
        - https://lit.dev/

  - 通信

    - 基于 URL

    - #### 发布/订阅模型

    - window 的 `CustomEvent`

# 微前端
微前端，将前端应用微服务化（即拆分成不同模块应用），并且能够合并成整体服务使用。

特性
不同模块都是独立的，意味着开发、部署都是独立
## 各类微前端解决方案

### single-spa

### qiankun

single-spa + sandbox + import-html-entry

### module federation
### [Magic Microservices](https://github.com/bytedance/magic-microservices/blob/main/README-zh_CN.md)

> [面向未来与浏览器规范的前端DDD架构设计](https://mp.weixin.qq.com/s/Br4cYZ1UDqwcBRKQTBqsMw)

Magic Microservices，就是类 `single-spa` + `web component` 的组合方案

复用
如何复用、复用手段
- copy
- npm package 机制
- monorepo
如何跨框架复用？需要处理兼容不同框架渲染机制
如何跨框架缝合新老系统？Iframe、微前端

技术背景：
跨框架复用，需要处理兼容不同框架 MDV 机制

微前端，行业上普遍的微前端解决方案也是在尝试如何做到在一个系统内完成多个框架的子系统调度

跨组件复用，

拆分单一应用
- 复用
- 内聚