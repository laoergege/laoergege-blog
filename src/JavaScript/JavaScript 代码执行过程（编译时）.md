## JavaScript 是 “解释型语言”？

很多 JS 初学者都会学习认为到 JS 是一个解释型语言，与之相对就是编译型语言，如 C/C++、GO。

但是**用解释型或者编译型来分类一个语言，是完全不正确的**。

编译跟解释只是源码到运行过程中的不同**执行流程行为**：

- 编译型：**程序执行之前，需要经过编译器的编译过程**，并且编译之后会直接**保留**机器能读懂的二进制文件，这样每次运行程序时，都可以直接运行该二进制文件，而**不需要再次重新编译**了。

- 解释型：程序在**每次运行时**才需要**通过解释器**对程序进行动态解释和执行。

其实语言一般只会定义其抽象语义，定义一组规范，而不会强制性要求采用某种实现方式。换句话说，只要能实现语义，你也可以写一个C的解释器解释运行 C，但 C 主流的是用GCC编译执行的，所以大多数人会认为 C 是编译型语言；就同比 JavaScript 是通过解释器执行，JavaScript 就是解释型语言。

## 编译器和解释器

虽然解释器不会像编译器直接编译成目标平台的可执行文件，但**任何语言都是需要从高到低编译成机器语言**。

解释器就是个黑箱，输入是源码，输出就是输入程序的执行结果，对用户来说中间没有独立的“编译”步骤。实际上很多解释器内部是以“编译器+虚拟机”的方式来实现的，先通过编译器将源码转换为AST或者字节码（可以获得跨平台），然后由虚拟机去完成实际的执行（如，JS 的 V8 引擎）。所谓“解释型语言”并不是不用编译，而只是不需要用户显式去使用编译器得到可执行代码而已。

> 虚拟机在执行字节码也有两种方式（编译和解释）：编译的话会把输入的源程序以某种单位（例如[基本块](http://en.wikipedia.org/wiki/Basic_block) / 函数/方法/trace等）翻译生成为目标代码，并存下来（无论是存在内存中还是磁盘上，无所谓），后续执行可以复用之，比如 JIT 方式；解释的话则把源程序中的指令是逐条解释，不生成也不存下目标代码，后续执行没有多少可复用的信息。

编译器和解释器工作流程：

![img](${images}/4e196603ecb78188e99e963e251b9781.png)

编译器和解释器流程中都有一段编译过程，将原码编译成中间码或者字节码。这个编译过程一般有三个阶段：

1. 词法分析
2. 语法分析
3. 语义分析



## 编译过程

### 词法分析

人们在看 C 语言源程序时，借助空格、括号等一眼就可以看出标识符、关键字。与人相比，现在计算机的智能还是相当低的，无法像人那样同时看多个字符。词法分析，目的就是在连续的字符中识别出一个一个的符号（token），并尽可能地识别出符号的属性。

<img src="${images}/838028071f63a132cc8b27b23960e5f5.png" alt="img" style="zoom: 50%;" />

### 语法分析

单个 token 是没有意义的，需要通过前后的其他符号组成一定的语法规则才能确定出一定的含义。语法分析就是在词法分析基础上根据语法规则把符号组成各类的语法单位，例如各种语句，表达式、程序块等。并且以树形结构去记录，就形成语法树（Abstract Syntax Tree，AST），该结构是计算机容易理解和处理的，和渲染引擎将 HTML 格式文件转换为计算机可以理解的 DOM 树的情况类似。

<img src="${images}/7320526ef14d974be8393effcf25b436.png" alt="img" style="zoom: 50%;" />

### 语义分析

语义分析是[编译](https://baike.baidu.com/item/编译/1258343)过程的一个逻辑阶段， 语义分析的任务是对结构上正确的[源程序](https://baike.baidu.com/item/源程序/9752646)进行上下文有关性质的审查，检查源程序是否符合程序语言的规则，语言设计的核心在语义阶段上体现出来。比如，在语言规范下：

1. 在同一个作用域内，不允许有两个名称相同的变量，这是唯一性检查



## V8 是如何执行一段 JavaScript 代码的

如果一种语言的主流实现是解释器，其内部是编译器+虚拟机，而虚拟机又是采用解释方式实现的，内部实现是编译器+树遍历解释器，那它就是名副其实的“解释型语言”。JavaScript 早期则是将源码编译成语法树，然后直接执行语法树。

<img src="${images}/1af282bdc4036096c03074da53eb84ae.png" alt="img" style="zoom:80%;" />

参考

- [JavaScript到底是解释型语言还是编译型语言?](https://segmentfault.com/a/1190000013126460)
- [什么是解释型语言？ - 李广胜的回答 - 知乎]( https://www.zhihu.com/question/268303059/answer/336730398)
-  [虚拟机随谈（一）：解释器，树遍历解释器，基于栈与基于寄存器，大杂烩](https://www.cnblogs.com/bozhang/articles/3115089.html)