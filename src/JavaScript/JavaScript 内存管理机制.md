# JavaScript 内存管理机制

## 内存生命周期

无论我们运行任何语言写的程序都会经历以下内存生命周期

<img src="${images}/1_slxXgq_TO38TgtoKpWa_jQ.png" alt="memory life" style="zoom:80%;" />

1. 分配内存：向操作系统申请分配内存。某些底层语言（如 C）需要显示申请操作，在高级语言当中，就不需要这样的操作
2. 使用内存：在代码中使用分配变量的进行读取和写入操作
3. 释放内存：当你不需要使用的时候，应该释放内存使之空闲可用。某些底层语言提供此操作。

## JavaScript 内存分配

### 内存模型

1. 栈

2. 堆
3. 数据段
4. 代码段

#### 栈内存

栈内存就是调用栈，是用来存储执行上下文。

#### 堆内存

JavaScript 引擎并不是直接将该对象存放到变量环境中，而是将它分配到堆空间里面，分配后该对象会有一个在“堆”中的地址，然后再将该数据的地址写进 c 的变量值，最终分配好内存的示意图如下所示：

<img src="${images}/22100df5c75fb51037d7a929777c57bc.png" alt="img" style="zoom:80%;" />

### Why 栈堆内存

为什么一定要分“堆”和“栈”两个存储空间呢？所有数据直接存放在“栈”中不就可以了吗？

“堆”和“栈” 其实只是个内存空间概念，实际内存上并什么区分。大多数语言利用该内存栈，来保存函数内部的局部变量，并且结合硬件（CPU 寄存器 esp、ebp 模拟栈顶、栈低指针）形成函数调用栈。栈在内存的分配与归还速度极快，因为也就是指针方向移动而已。

所有数据不可以直接存放在栈内存中，因为操作系统划分的栈空间大小有限，数据量过大时，也就容易发生栈溢出。

### 闭包的内存形成

## 垃圾回收

## 优化策略
