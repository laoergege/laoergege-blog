---
discussionID: q-GrZ-WR09Pkeq4rgC6ix
---
# NAT

- NAT(IP Network Address  Translator)：网络地址转换协议
  - 作用
    - 解决 IPv4 地址不够用的问题，让多台主机共用一个公网 IP 地址，在内部使用内网 IP 进行通信
    - 解决安全问题：隐藏内网的拓扑结构、隐藏主机
  - 原理
    - 内网中存在拥有公网 IP 地址的路由器
    - 发送的时候，NAT 替换源 IP 地址（也就是将内网 IP 替换为出口 IP）
    - 接收的时候，NAT 替换目标 IP 地址（也就是将出口 IP 替换回内网 IP 地址）
    - NAT 通常需要缓存内外网 **IP 地址 + 端口** 的映射表
  - 类型（所谓的“打洞”就是在 NAT 上建立一个内外网的映射表）
    - 完全锥型 NAT：任何外网主机都可以共享“洞口”（即转换的外网 IP、端口）![图 2](./images/1672252770969.png)  
    - IP 地址受限锥形NAT：限制只有访问过的外网主机 IP 才能穿越 NAT ![图 3](./images/1672252936428.png)  
    - 端口受限锥形NAT：限制只有访问过的外网主机的 IP 及应用端口才能穿越 NAT  ![图 4](./images/1672253000540.png)  
    - 对称型 NAT：每次不同的请求（访问的主机 IP 及应用端口的不同）都需要重新“打洞”  ![图 5](./images/1672253098888.png)  
  - NAT 穿透

## NAT 穿透

NAT 穿透：为了让外网主机能够访问内网主机，就需要 NAT 后面的主机向公网发送一个包，也就在 NAT 打洞。其他主机只要知道了这个端口，就可以向内网主机发送数据了。