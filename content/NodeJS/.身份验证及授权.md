---
discussionID: EQuq3aWis-3frfb3v4QdN
---
# 身份验证和权限校验

- 身份验证
  - 密码验证：使用账户密码进行身份验证，通过后就需要发放**访问凭证**来保证应用程序的后续交互，**凭证验证机制**主要分两种
    - 基于会话（cookie）的身份验证
      - 有状态：需要在服务器或会话中存储有关我们用户的任何信息，表示登陆状态
      - 适合复杂的用户状态管理场景
      - 中心化 => Session 分布式问题
        - redis + token：独立的 Redis 缓存服务器共享 session
      - ![图 1](images/400e1b1b80abb1fbb968eab089afff0de93efb9623b9a5490787010e9ae54409.png)  
    - 基于令牌的身份验证：对用户发放特殊设计的**签名**令牌，服务端只需对用户请求中的令牌进行**校验是否有效即可**
      - 无状态、去中心化
      - 续签问题：Token 刷新
        - refresh token
      - [JWT（JSON Web Token）](https://jwt.io/)
        - 是一种开放的 Token 设计标准，允许在两方之间进行安全、可靠的通信
        - jwt = header.payload.signature
          - Header = base64url({ typ, alg, ...})
            - typ：表示令牌类型，JWT 令牌统一写为 JWT
            - alg：签名算法，默认为 HS256
          - Payload = base64url({...})
          - Signature = HASH(Header.Payload, secret)
        - ![图 2](images/19e935a4fd0215fbb9e468ee9b26dc8bbe4b134597ac33b3fce4923bb0f5f602.png)  
      - OAuth
  - 无密码验证
  - SSO：单点登录，一次登录全线通用
    - 顶级域相同
      - cookie 顶级域共享 + 共享 session/token
    - 顶级域不同
      - 独立的**认证服务**（通常被称为 SSO）
- 权限设计
  - ACL 即访问控制列表，它的核心在于用户直接和权限挂钩
  - RBAC 核心是用户只和角色关联，而角色对应了权限




将认证信息存放在标记为HttpOnly，Secure，Same-Site=strict的Cookie中，从而避免XSS和CSRF；