错误处理
  - 错误类型
    - 操作错误：是运行时可预测的错误，需要处理
    - 程序员错误
    - 异常：是执行过程无法预测的，得终止执行
  - 实践
    - 扩展错误对象：规范化错误类型，友好
      - 内置错误对象 Error
        - 堆栈跟踪
          - Error.stack 
            - `Error.captureStackTrace(obj, func)`
          - console.trace
      - 中间件
    - 传递错误
      - return / callback 
      - throw
      - 异步错误
        - promise.reject
        - EventEmitter.emit("error")
    - 错误处理
      - 捕获
        - callback error
        - async/await 和 try-catch
        - promise 中使用 .catch() 错误
        - EventEmitter
      - 全局
        - 捕获所有未捕获的异常 process.on('uncaughtException'
        - 捕获所有未处理的承诺拒绝 process.on('unhandledRejection', callback)
    - 错误日志（打印、上传）及警报
      - [consola](https://github.com/unjs/consola)

- 
- 。最好的方法是让应用程序崩溃，记录错误，然后使用 nodemon 或 pm2 自动重启进程。
- 如果未正确处理 JavaScript 错误，则会发出 uncaughtException


NodeJS 中错误
  - 用户指定错误
  - 断言错误
  - JS 错误
    - EvalError
    - RangeError
    - ReferenceError
    - SyntaxError
    - TypeError
    - URIError
    - Async errors
  - [Node 系统错误](https://nodejs.org/api/errors.html#errors_class_systemerror)



- 如何处理好错误
  - 错误类型
    - 错误
    - 异常：如果一个错误出了程序员不在意，或者没法在意，那么就是一个异常。异常是程序员不处理的错误。异常意味着程序进入了一个未知的，不确定的状态。
      - throw：让上层处理问题，决定自己到底是不管直接挂掉还是把程序从有问题的状态转变回来。
        - 挂掉：异常意味着程序运行的状态处于一个非预期的状态，在没有事先设计过错误处理路径的情况下，挂掉是最好的选择。这通常被称为fail-fast。
          - 灰度开发和发布流程，即可以让不稳定的代码在一个风险可控的范围内跑，尽情的暴露各种问题，尽快的crash，然后开发者尽快去修
          - 隔离，重启
  - 错误形式
    - 错误码信息
    - 错误类型化
  - 错误处理
    - 调用者角度：错误发生 => 错误类型捕获 => 立即处理、延迟处理（传播）
    - 传递
      - 返回
      - 抛出
    - 处理
  - 模式
    - 错误分离
  - 工作模式
    - 编写正确的代码
      - 在代码中每次都处理错误
    - 快速开发
      - 只处理少数的必要的错误
      - 粗略集中处理
      - 监控：实时抓取运行时发生的各种问题
  - 编程语言-错误设计
    - 所有错误处理必须 "checked"。对于所有错误程序员必须显示的处理，不然编译过不去
    - 编译器应该尽力提醒程序员不要忽略错误。程序员要不处理错误，或者明确告诉编译器这个错误我觉得可以不处理
  - 语法范式
    - 关键点在于如何表达错误，如何避免开发者遗漏错误，如何组合多个可能发生错误的代码，如何提供语法糖简化一些不得不写的，反复重复的代码。

## Nodejs 错误最佳实践

1. 自定义扩展错误类型


- 未捕获的异常 `uncaughtException`
  - uncaughtException是在关闭进程之前对分配的资源（例如文件描述符、句柄等）执行同步清理
  - 让应用程序崩溃，记录错误，然后使用 nodemon 或 pm2 自动重启进程


- 性能
- 稳定性
- 可维护性
- 可扩展性